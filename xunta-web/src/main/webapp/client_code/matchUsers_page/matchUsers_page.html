<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="apple-mobile-web-app-capable" content="yes"/>
		<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
		<title>聊天页</title>
		<link rel="stylesheet" type="text/css" href="matchUsers_page.css"/>
		<link rel="stylesheet" type="text/css" href="matchUsers_page_web.css"/>
		<link rel="stylesheet" type="text/css" href="dialoglist_page.css"/>
		<link rel="stylesheet" type="text/css" href="dialoglist_page_web.css"/>
        <link rel="prefetch" href="../image/acclaim-50x173.png" />
        <link rel="prefetch" id="prefetch_adminimage" href="" />
		<link rel="prefetch" id="prefetch_userimage" href="" />

	</head>
	<!--下面的为元素库,与代码直接相关,不要作任何变动,运行时会hide掉-->			
		
    <body>
		<!--div id="notification">通知栏</div-->
		<div id="header">
			<div id="goback" onclick="backBtn()"><img src="../image/goback5.png" /></div>
			<div id="title">匹配人列表页</div>
			<!-- <div class="_closeBtn" onclick="closeBtn()"><img src="../image/close.png" ></div> -->
		</div>
		
		<div class="wrap" id="wrap">
    		<ul class="tabClick">
        		<li class="active">匹配</li>
        		<li>对话</li>
    		</ul>
        	<div class="tabBox">
        		<!-- 第一个页面 -->
            	<div class="tabList">
            		<div class="showMatchUsers">
            			<div id="showMatchUsers" style="float:left;width:100%;"><!-- 2017.12.22  叶夷  这里是为了获得匹配人内容的实际高度 -->
            				<!-- 2017.12.22 叶夷  更多的按钮-->
							<div class="noMatchUser" id="noMatchUser">更多</div>
            			</div>
            			
						<!--  2017.08.15  叶夷   一个匹配人 -->
						<!-- <div class="matchUser" id="matchUser">
							<div class="userimg">
								<img id="user_img" src="http://www.mxunta.so:80/xunta-web/useravatar/thumb_img_804622010041896960/jpg/image" >
								<div class="username" id="username">叶汉良</div>
							</div>
							<div class="userTags">
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
							</div>
							<div class="userTags">
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
								<div class="userTag">核武器</div>
							</div>
							<div class="sendMsg">
								发消息
							</div>
						</div> -->
					</div>
            	</div>
            	
            	<!-- 第二个页面 -->
            	<div class="tabList">
            		<div id="dialog_list">
            			<!-- <div class="dialog cursor" id="932910158315655168">
            				<img src="http://wx.qlogo.cn/mmopen/vi_32/V0eZwlzGtOo9L9Mde6uN8CJLgQkmk2wE089XLfcbqh6icP75yI8YVWO8UMCTF8Q9Az0e8pGIfJMxg17HBiaHRyBg/0" onerror="javascript:this.src='http://42.121.136.225:8888/user-pic2.jpg'" style="height: 46.719px; width: 46.719px; margin-left: 30.281px;">
            				<div class="dialog_content" style="height: 55.0962px; width: 414.578px; margin-left: 15.1405px;">
            					<div class="dialog_content_top">
            						<div class="dialog_content_name" style="line-height: 28px; font-size: 19.6px;">叶汉良4</div>
            						<div class="dialog_content_time" style="line-height: 28px; font-size: 14px;">星期二</div>
            					</div>
            					<div class="dialog_content_msg" style="font-size: 16.25px;">你好</div>
            				</div>
            			</div> -->
            		</div>
        		</div>
    		</div>
		</div>
	</body>
	<script type="text/javascript" src="../script/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="../script/common-xunta.js"></script>
    <script type="text/javascript" src="../script/common-xunta_web.js"></script>
    <script type="text/javascript" src="matchUsers_page_common_web.js"></script>
    <script type="text/javascript" src="matchUsers_page_common.js"></script>
    <!-- 这是聊天列表的js信息 -->
    <script type="text/javascript" src="dialoglist_page_common_web.js"></script>
    <script type="text/javascript" src="dialoglist_page_common.js"></script>
    <!-- 下拉刷新控件 -->
    <script src="../script/idangerous.swiper.min.js"></script> 
    <!-- 这是为了移动端web的调试 
	<script src="../script/debuggap.js" type="text/javascript"></script>-->

	<script type="text/javascript">
		var userId;//发送的人，即自己
		var userName;	//直接上屏用得着.
        var userImage;	//直接上屏时用得着.
        
		var adminName;
		var adminImageurl;
		var _topicPageSign;

        var domain;
        var userAgent;
        
        var domain;
        var userAgent;
        var unreadObjList;//2017.08.16 从首页传过来的未读信息
        
        var matchUserList;//2017.12.20  叶夷   使用一个数组存储匹配人详情数据
        var requestAllCounts=200;//2017.12.20  叶夷     请求匹配人详情的数量
        var requestOneCounts=10;//2017.12.20  叶夷     请求每一页匹配人详情的数量
        
        var isFirst=true;//这是第一次请求匹配人详情，则聊天列表重新请求，如果不是则聊天列表不请求
		
        function start(Parameter){//web:在openWin时通过ready后回调,再跨页执行方式来启动的第一个方法.
            domain = Parameter.server_domain;
            userId = Parameter.userid;
            userName = Parameter.userName;
            userImage = Parameter.userImage;
            
            adminName = Parameter.adminName;
            adminImageurl = Parameter.adminImageurl;
            userAgent = Parameter.userAgent;
            _topicPageSign = Parameter.topicPageSign;
            unreadObjList=Parameter.unreadObjList;
            
            execRoot("setCurrentPageId('matchUsers_page')");
            
          	//2017.12.13 叶夷  请求详细匹配人列表
          	requestDetailMatchedUsers();
        }
        //2017.12.20  叶夷    这里是实现匹配人详情页tab滑动的效果
        window.onload = function (){
            var windowWidth = document.body.clientWidth; //window 宽度;
    		var wrap = document.getElementById('wrap');
    		//将wrap的width固定成数值，为了在手机上不突然变大
    		wrap.style.width=windowWidth+"px";
    		
    		//wrap的height设置
    		var headerHeight=$("#header").height();
    		var wrapHeight=document.body.clientHeight-headerHeight;
    		wrap.style.height=wrapHeight+"px";
    		
            var tabClick = wrap.querySelectorAll('.tabClick')[0];
            var tabLi = tabClick.getElementsByTagName('li');
            
            var tabBox =  wrap.querySelectorAll('.tabBox')[0];
            var tabList = tabBox.querySelectorAll('.tabList');
            
          	//tabBox的height设置
          	var tabClickHeight=$(".tabClick").height();
          	var tabClickMarginBottom=parseInt($(".tabClick").css("margin-bottom"));
          	var tabBoxHeight=wrapHeight-tabClickHeight-tabClickMarginBottom;
          	tabBox.style.height=tabBoxHeight+"px";
            
            var tar = 0;
            var endX = 0;
            var dist = 0;
            
            tabBox.style.overflow='hidden';
            tabBox.style.position='relative';
            tabBox.style.width=windowWidth*tabList.length+"px";
            
            for(var i = 0 ;i<tabLi.length; i++ ){
                  tabList[i].style.width=windowWidth+"px";
                  tabList[i].style.float='left';
                  tabList[i].style.float='left';
                  tabList[i].style.padding='0';
                  tabList[i].style.margin='0';
                  tabList[i].style.verticalAlign='top';
                  tabList[i].style.display='table-cell';
            }
            
            for(var i = 0 ;i<tabLi.length; i++ ){
                tabLi[i].start = i;
                tabLi[i].onclick = function(){
                    var star = this.start;
                    for(var i = 0 ;i<tabLi.length; i++ ){
                        tabLi[i].className='';
                    };
                    tabLi[star].className='active';
                    init.translate(tabBox,windowWidth,star);
                    endX= -star*windowWidth;
                }
            }
            
            function OnTab(star){
                if(star<0){
                    star=0;
                }else if(star>=tabLi.length){
                    star=tabLi.length-1
                }
                for(var i = 0 ;i<tabLi.length; i++ ){
                    tabLi[i].className='';
                };
                
                 tabLi[star].className='active';
                init.translate(tabBox,windowWidth,star);
                endX= -star*windowWidth;
            };
            
           /*  tabBox.addEventListener('touchstart',chstart,false);
            tabBox.addEventListener('touchmove',chmove,false);
            tabBox.addEventListener('touchend',chend,false);
            //按下
            function chstart(ev){
                ev.preventDefault;
                var touch = ev.touches[0];
                tar=touch.pageX;
                tabBox.style.webkitTransition='all 0s ease-in-out';
                tabBox.style.transition='all 0s ease-in-out';
            };
            //滑动
            function chmove(ev){
                var stars = wrap.querySelector('.active').start;
                ev.preventDefault;
                var touch = ev.touches[0];
                var distance = touch.pageX-tar;
                dist = distance;
                init.touchs(tabBox,windowWidth,tar,distance,endX);
            };
            //离开
            function chend(ev){
                var str= tabBox.style.transform;
                var strs = JSON.stringify(str.split(",",1));  
                endX = Number(strs.substr(14,strs.length-18)); 
                
                if(endX>0){
                    init.back(tabBox,windowWidth,tar,0,0,0.3);
                    endX=0
                }else if(endX<-windowWidth*tabList.length+windowWidth){
                    endX=-windowWidth*tabList.length+windowWidth
                    init.back(tabBox,windowWidth,tar,0,endX,0.3);
                }else if(dist<-windowWidth/3){
                     OnTab(tabClick.querySelector('.active').start+1);
                     init.back(tabBox,windowWidth,tar,0,endX,0.3);
                }else if(dist>windowWidth/3){
                     OnTab(tabClick.querySelector('.active').start-1);
                }else{
                     OnTab(tabClick.querySelector('.active').start);
                }
                var stars = wrap.querySelector('.active').start;
            }; */
    	};
    	
        var init={
            translate:function(obj,windowWidth,star){
                obj.style.webkitTransform='translate3d('+-star*windowWidth+'px,0,0)';
                obj.style.transform='translate3d('+-star*windowWidth+',0,0)px';
                obj.style.webkitTransition='all 0.3s ease-in-out';
                obj.style.transition='all 0.3s ease-in-out';
            },
            touchs:function(obj,windowWidth,tar,distance,endX){
                obj.style.webkitTransform='translate3d('+(distance+endX)+'px,0,0)';
                obj.style.transform='translate3d('+(distance+endX)+',0,0)px';
            },
            lineAnme:function(obj,stance){
                obj.style.webkitTransform='translate3d('+stance+'px,0,0)';
                obj.style.transform='translate3d('+stance+'px,0,0)';
                obj.style.webkitTransition='all 0.1s ease-in-out';
                obj.style.transition='all 0.1s ease-in-out';
            },
            back:function(obj,windowWidth,tar,distance,endX,time){
                obj.style.webkitTransform='translate3d('+(distance+endX)+'px,0,0)';
                obj.style.transform='translate3d('+(distance+endX)+',0,0)px';
                obj.style.webkitTransition='all '+time+'s ease-in-out';
                obj.style.transition='all '+time+'s ease-in-out';
            },
        }
		
	</script>
</html>